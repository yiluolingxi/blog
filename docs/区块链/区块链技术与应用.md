# 区块链

**区块链** ：就是一个一个区块组成的链表，每个区块有一个块头`block header`，`block header`里面有很多的阈，其中有一个阈是我们可以设置的随机数`nonce`。  

**挖矿** ：挖矿过程就是在给定的目标空间（target space）和参数（args）信息下，不停的去试各种`nonce`，使得整个`block header`取哈希之后，落在指定的范围之内，小于等于一个`target space`。  
![](Pasted%20image%2020240315215632.png)
![](Pasted%20image%2020240315221853.png)
这个是整个的`output space`（输出空间），我们要求这个算出的哈希值只有落在前面`target space`才是合法的。
# 比特币 

**BTC 比特币（Bitcoin）**： `Crypto-currency`（加密货币，/ˈkrɪptəʊˌ'kʌrənsi/），目的是提供一种不依赖于中央机构的电子支付系统， 它允许人们通过一个去中心化的网络进行交易，该网络基于一种称为区块链的分布式账本技术，处理和记录所有的 `transactions`（交易）。  
用户通过 挖矿 过程来创建新的 BTC 。      

当前的加密货币，是不加密的，区块链上所有的交易内容都是公开的（包括账户的金额、转账的地址都是公开的）。     

**比特币用的哈希函数**叫做`SHA-256`  
`SHA`意思是Secure Hash Algorithm(安全哈希算法)  

`SHA`拥有3个特质：   
- Collision Resistance
- hiding
- puzzle friendly

比特币中运用到了密码学中的两个功能：   
**Hash（哈希）**  
**Signatures （签名）** /ˈsɪɡnətʃə(r)z/

## Hash
**哈希函数**：一种将输入数据（无论大小）转换成固定大小输出的函数。用于加密、数据完整性验证等多种场景。在BTC的区块链技术中，SHA-256用于生成交易的哈希值、计算区块的哈希值等。    

**密码学中用的哈希函数**被称为：`cryptographic hash functions` 加密哈希函数。/ˌkrɪptəˈɡræfɪk/  
    
### 它用到密码学中两个比较重要的性质：

**Collision Resistance（/kəˈlɪʒən rɪˈzɪstəns/, 抗碰撞性）**：这保证了不同的输入会产生不同的哈希值、哈希函数的唯一性。
- **Strong Collision Resistance  （强抗碰撞性）**：很难找到任意两个不同的输入，它们产生相同的输出。 X≠Y, H(X)=H(Y) 
- **Weak Collision Resistance （弱抗碰撞性）**：给定一个固定的输入，很难找到另一个不同的输入，使得两者产生相同的输出。

**hiding（单向藏匿性）** ：加密哈希函数的计算过程是 单向的，不可逆的。  
意味着对于给定的哈希输出，无法确定任何有关输入的信息。确保信息不被恢复或推断。  
X ->H(X)，不能反推

### 除了密码学中要求的这2个性质之外，比特币中用到的哈希函数还要求第3个性质：

**puzzle friendly （难题友好性）**：哈希值的计算事先是不可预测的。你光是看这个输入，你很难猜出来他最后的哈希值是什么。  

### **Collision Resistance** 性质的作用：  

- 在数据传输和存储过程中，**Strong Collision Resistance**性质可以帮助验证数据的完整性。通过比较发送方和接收方计算的哈希值，可以确定数据是否在传输过程中被篡改。

- 在数字签名技术中，**Strong Collision Resistance**性质确保了签名的唯一性和不可篡改性。只有原始消息的发送者才能生成与之对应的唯一签名，而任何对消息的修改都会导致签名的改变。 

- 密码学中，**Strong Collision Resistance**性质对于保护密码的安全至关重要。    
  例如，密码的哈希值可以用于存储，而不是直接存储密码本身。当用户输入密码时，系统会对输入的密码进行哈希，并与存储的哈希值进行比较，以此验证密码是否正确。

例子：  
它可以用来对一个`message`求`digest` ，比如说我们有个`message`叫`m`,我们取他的哈希值`H(m)`,这个哈希值可以认为是这个`message`的`digest`, 用来检测对这个`message`的篡改,比如说如果有人改这个`message`内容，它的哈希值就会发生变化。  

collision resistance性质就是说你找不到另外一个`m'`，使得这个`m'`取哈希之后`H(m')`跟原来的哈希值恰好相等。也就是说，没有办法能够篡改内容而又不被检测出来。  

### hiding 性质的作用
可以和 **Collision Resistance** 的性质结合在一起，用来实现**digital commitment** 数字承诺（Digital equivalent of a sealed envelope 密封信封的数字等价物）。  

**Collision Resistance** 保证了不同的输入会产生不同的哈希值，而 **hiding** 则保证了即使知道哈希值，也无法反推出原始信息。   

类比预言术：若直接预言明天股票涨停或者跌停且广而告之，可能触发**羊群效应**，被玩家做多或者做空。若不将消息透露，则消息不可信，无人见证，触发**薛定谔的玄学力量**。倘若将预言信息 `hash(msg)` 传播出去，等到开盘当天，将msg透露，则用户可以轻松鉴定预言是否正确。

例子：  
先说一下现实生活中**sealed envelope**（数字安全领域的加密技术）的作用，比如说有一个人说他能够预测股市，可以预测第二天哪些股票会涨停。那怎么证明这个人预测的是不是准确呢？一种办法是，这人提前一天在电视台上公布预测结果，我预测明天某某股票会涨停。第二天收盘之后呢，看一下这个股票是不是真的涨停，就知道预测准不准。这样做有什么问题吗？这好像是一种检验预测准的方法，有什么问题？如果你预测结果提前公布了，可能会影响股市，就比如说这个人很有名气，大家觉得这是个股神，本来这支股票不会涨停，他这么一公开预测，大家拼命去买，结果它变成了涨停。当然，反方向的情况也可能发生，这支股票也许本来确实是要涨停的，有人想踢场子，你不是预测它涨停吗？我就不让他涨停，拼命的砸盘，这都有可能发生。这说明一个什么道理？预测结果不能够提前公开。但是如果预测结果不提前公开，你等第二天收盘了之后再公开，那你怎么知道这个预测结果有没有被篡改，你最后公开的结果是不是你提前一天做出来的，这个就要用到我们说的**sealed envelope**，叫你把你的一结果写在一张纸上，放到一个信封里给封好了，这个信封要交给第三方的公证机构保管，等第二天收盘之后再把它打开，验证一下这个结果准不准。

那在电子世界里，我要有一个Digital（"Digital"指的是数字资产或数字化的资产） ，**sealed envelope**怎么实现？  
把这个预测结果作为输入X，算出一个哈希值，然后把这个哈希值可以公布出去，因为我们有这个**hiding** 的性质，所以你从这个哈希值不知道预测结果是什么，然后第二天收盘之后呢，我再把预测结果公布出去，因为有这个**Collision Resistance** 的性质，所以我这个预测结果是不可能篡改的，你要是改的话，就跟当初公布的这个哈希值是对不上。这就起到一个**sealed envelope**的功能。

### puzzle friendly 性质的作用：  
对于 `H(block header) <= target space` 其中BTC的 `block header == args + nonce` 给定target space和 args信息，求nonce

在BTC上的应用就是挖矿，上述求nonce的过程称为挖矿。如果给出一个随机源良好的message和一堆目标值target-space，谜底是找出所有使得 `H(message||nonce)` 满足target-space要求的nonce。找到nonce的过程称为 `Proof of Work` 工作量证明(PoW) 。  

例子：
这种 **puzzle friendly** 的特性使得挖矿过程具有高度的安全性和难度，因为即使知道了目标空间和参数，也很难在短时间内找到正确的nonce。
**puzzle friendly**的性质是说，这个挖矿的过程没有捷径，只能靠不停的去试大量的`nonce`，才能找到符合要求的值，所以这个过程才可以用来作为`Proof of work`工作量证明。  
你挖到矿了，找到符合要求的，那一定是因为你做过大量的工作，没有捷径。   
但是一旦有人找到了这样一个`nonce`，发布出去之后，其他人要验证这个`nonce`是不是符合要求是很容易的，只要算一次哈希值就行了，就这个`nonce`作为`header`的一部分，算一次哈希值，看它是不是小于等于这个目标阈值。  挖矿很难，验证很容易。这个性质叫做: `diffcult to solve,but easy to verify`。一个问题的解决方案可能非常复杂，需要大量的计算资源和时间来找到，但一旦找到了一个解决方案，验证这个解决方案是否正确则相对容易。

### FAQs
**哈希碰撞及特点**？  
像我们使用哈希表的过程中，就会遇到哈希碰撞，不同的输入可能会被映射到哈希表当中的同一个位置。
一般来说呢，哈希碰撞是不可避免的，因为输入空间是远远大于输出空间。  

**输出空间有多大**？   
比特币中哈希值的取值可能就是2的256次方，输出空间就只有这么大。  

**输入空间有多大**？  
可以是无限大的，所以它是有任意多种数的可能性。  
按照鸽笼原理（Pigeonhole Principle，/ˈpɪdʒənˌhoʊl ˈprɪnsəpl/）的话，必然会出现有两个输入被映射到同一个输出的情况。

**collision resistance**？  
这里指没有什么高效的方法，人为的去制造哈希碰撞。实际上碰撞是客观存在的。      
硬要找的话，可以用暴力破解`Brute-force`的方法，比如说X和Y，你就遍历所有输入的可能性，然后看看哪一个算出来它是相等的。 但是如果这个输入空间比较大，比如说是对于一个哈希值是256位的话，用这种方法去找，在实际中是不可行的，他工作量实在是太大了。

没有哪个哈希函数,能够在数学上证明是**Collision Resistance**，也就是说从理论上是证不出来的，这个只能靠实践中的经验。有些哈希函数经过长期的实践检验，世界上有那么多密码学的专家，谁也没有能够找到人为制造哈希碰撞的方法，所以呢，我们就认为这些哈希函数是肯定**Collision Resistance**，比如实践经验。也有一些哈希函数，以前我们认为是**Collision Resistance**，但是后来大家找到了制造哈希碰撞的方法

- MD5:曾经是很流行的哈希函数，大家原来以为它很安全，但是现在已经不行了，我们已经知道怎么去人为的制造哈希碰撞。

**哈希值的取值范围**？  
取决于哈希函数的设计和应用场景。一般来说，哈希函数的输出可以是任意大小的数字或字符串，但是在实际应用中，哈希值通常是固定长度的。例如，MD5哈希函数生成的哈希值是128位（16字节）长。    
- **MD5**: 生成128位（16字节）的哈希值。
- **SHA-1**: 生成160位（20字节）的哈希值。
- **SHA-256**: 生成256位（32字节）的哈希值。
- **SHA-512**: 生成512位（64字节）的哈希值。
哈希函数的设计目的：是将任意长度的输入数据映射到固定长度的哈希值上，以便于数据的快速查找和比较。 长度直接影响了哈希函数的安全性和冲突概率。 较长的哈希值通常意味着更高的安全性，因为它更难以通过碰撞攻击找到两个不同的输入数据产生相同的哈希值。

**鸽巢原理** ?  
假设你有n+1个鸽子和n个鸽巢，如果每个鸽子都要进入一个鸽巢中，那么至少有一个鸽巢里会有两个或以上的鸽子。应用到哈希函数上，由于输入的可能性是无限的，而输出的长度是固定的，因此必然存在至少两个不同的输入被映射到同一个输出。  

**薛定谔的玄学力量**？  
可以被理解为量子力学中的一种现象，即系统的状态在被观察之前是不确定的，直到被观察时才确定。  
这种现象在量子力学中被称为“观察者效应”，因为观察者的行为（如测量）会影响系统的状态。这种现象在实际应用中，如量子计算机和量子加密技术，都有着重要的意义。  

**block header == args + nonce**？
在区块链技术中，用于描述区块头（block header）是由参数（args）和随机数（nonce）组合而成的。  
`args` 通常指的是区块头中的其他数据，如前一个区块的哈希值、时间戳、难度目标等，而 `nonce` 是一个随机数，用于挖矿过程中生成一个满足网络难度要求的哈希值。 `nonce` 是一个32位的随机数，有四十亿种可能的组合。   

**BTC中有没有用到弱抗碰撞性？**
比特币（BTC）的底层技术使用了哈希函数，特别是SHA-256哈希算法。
哈希函数是一种将输入数据（无论大小）转换成固定大小输出的函数，通常用于加密、数据完整性验证等多种场景。在比特币的区块链技术中，SHA-256用于生成交易的哈希值、计算区块的哈希值等。

在哈希函数的上下文中，"碰撞"是指两个不同的输入产生相同的输出。根据抗碰撞性的定义，我们区分为两种类型：

- **弱抗碰撞性**：对于一个给定的输入和它的哈希值，很难找到另一个不同的输入有相同的哈希值。
- **强抗碰撞性**：很难找到任何两个不同的输入，使它们产生相同的哈希值。

比特币在其核心功能中确实依赖于SHA-256哈希函数的强抗碰撞性。这是为了确保区块链的安全性和不可篡改性。弱抗碰撞性在比特币的应用中隐含地被使用，因为强抗碰撞性包含了弱抗碰撞性的特性。换言之，如果一个哈希函数像SHA-256那样具有强抗碰撞性，那么它自然也满足弱抗碰撞性的要求。

弱抗碰撞性保护比特币网络不受某些特定类型的攻击，例如尝试创建一个具有相同哈希值的伪造交易。通过确保即使是微小的输入差异也会导致哈希输出的巨大变化，比特币的哈希函数帮助保持了整个系统的安全和完整性。