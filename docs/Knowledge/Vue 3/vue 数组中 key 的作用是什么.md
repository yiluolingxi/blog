
### 总结

在Vue中，数组中key的作用是为了更高效地更新虚拟DOM。当Vue用v-for更新已经渲染的元素列表时，它默认使用“就地复用”策略。  
意味着不会对已经渲染的元素进行任何移动或删除操作，仅仅是对已经渲染的元素进行修改。    
如果没有为每个元素分配一个唯一的`key`，那么每次更新时 Vue 都需要遍历整个列表来比较新旧节点的差异，这样会影响性能。

---

在Vue中，`key`属性用于给Vue的虚拟DOM算法提供一个提示，以便在比较新节点列表和旧节点列表时识别VNodes [[4]](https://vueschool.io/articles/vuejs-tutorials/tips-and-gotchas-for-using-key-with-v-for-in-vue-js-3/)。  
当使用`v-for`基于数组渲染一个列表项时，必须包含`key`属性，以确保Vue可以在数组变化时高效地更新DOM [[3]](https://vuejs.org/guide/essentials/list.html)。 

以下是在Vue中使用`key`的关键要点：

- 对于列表中的每个项，始终提供唯一的`key`，以帮助Vue识别哪些已更改和哪些未更改。
- 使用每个项中的唯一标识符作为`key`属性。例如，如果列表中的项是具有`id`属性的对象，请使用`:key="item.id"。
- 避免使用数组索引作为`key`，因为索引仅表示项在数组中的位置，而不是项本身的标识符。使用     索引作为`key`可能会导致添加或删除数组中的项时出现问题，因为本地数据可能不会随之更新。
- 不要使用非基本类型的值（如对象和数组）作为`key`属性。改用字符串或数字值。
- 建议始终在`v-for`中提供`key`属性，除非迭代的DOM内容很简单，或者您故意依赖默认行为以提高 性能。

---

### 追根究底

- 本地数据可能不会随之更新

在Vue中，当使用`v-for`基于数组渲染一个列表项时，必须包含`key`属性，以确保Vue可以在数组变化时高效地更新DOM [[3]](https://laracasts.com/discuss/channels/vue/prevent-show-duplicate-value-in-v-for)。如果没有提供`key`属性，则Vue将无法确定每个节点的标识符，并且可能会在视图中出现意外行为。

如果在`v-for`中没有使用`key`属性，Vue可能会在更新DOM时出现问题。例如，如果从数组中删除一个项，则Vue将删除具有相同数组索引的节点，而不考虑该节点实际上代表的内容。这可能会导致本地数据与视图不同步，因为Vue删除了错误的节点，而不是实际上需要删除的节点。为了避免这种情况，始终为列表项提供唯一的`key`属性[[4]](https://forum.vuejs.org/t/v-for-with-simple-arrays-what-key-to-use/13692)。


- 不要使用非基本类型的值（如对象和数组）作为`key`属性。改用字符串或数字值

在Vue中，不要使用非基本类型的值（如对象和数组）作为`key`属性。相反，应改用字符串或数字值。这是因为Vue使用`key`属性来跟踪每个节点的标识符，并在比较新节点列表和旧节点列表时识别VNodes 如果使用非基本类型的值作为`key`属性，则可能会出现意外行为，因为Vue无法正确地比较和识别这些值。  

例如，如果将对象作为`key`属性，则Vue将比较对象的引用而不是其内容。这意味着即使两个对象具有相同的内容，它们也不会被视为相等，因为它们是不同的对象。这可能会导致Vue在更新DOM时出现问题，因为它无法识别旧节点列表中的相应节点。同样，如果使用数组作为`key`属性，则Vue将比较数组的引用而不是其内容。这可能会导致添加或删除数组中的项时出现问题，因为Vue无法正确地识别哪些节点已更改或删除。  


- 要避免使用索引数组列表项的key属性

因为索引只是数组中项的位置指示符，而不是项本身的标识符，这可能会导致意外行为。使用索引作为`key`属性可能会导致数据和视图不同步，因为在更新DOM时，Vue无法识别哪些节点已更改或删除。因此应该避免使用索引数组列表项的`key`属性。

相反，可以使用唯一的字符串或数字值作为数组列表项的`key`属性，以确保Vue可以正确识别和比较节点。例如，可以使用`item.id`作为对象列表项的`key`属性，或者使用唯一的数字值作为数组列表项的`key`属性。在这种情况下，Vue将使用唯一的标识符来跟踪每个节点，并在比较新节点列表和旧节点列表时正确地识别VNodes。   

因此，虽然可以使用索引作为数组列表项的`key`属性，但这并不是最佳实践。相反，应该使用唯一的字符串或数字值作为`key`属性，以确保Vue可以正确识别和比较节点，避免数据和视图不同步的问题。


- 建议始终在`v-for`中提供`key`属性，除非迭代的DOM内容很简单，或者您故意依赖默认行为以提高 性能

在Vue中，建议始终在`v-for`中提供`key`属性，以确保Vue可以正确地跟踪每个节点的标识符。如果不提供`key`属性，则可能会出现意外行为，例如在DOM中重新排序或添加/删除节点时，可能会导致数据和视图不同步。在这种情况下，Vue可能会重用现有的DOM元素而不是创建新的元素，这可能会导致组件未被正确初始化，并且可能会导致组件逻辑无法正确运行。

相反，如果为`v-for`提供了`key`属性，则Vue将使用该属性来跟踪每个节点的标识符，并在比较新节点列表和旧节点列表时正确地识别VNodes。这可以确保Vue可以正确地更新DOM并确保数据和视图同步。例如，可以使用唯一的字符串或数字值作为`key`属性，以确保Vue可以正确识别和比较每个节点。

但是，如果迭代的DOM内容非常简单，或者您故意依赖默认行为以提高性能，则可以省略`key`属性。在这种情况下，Vue将使用默认行为来更新DOM，这可能会导致性能提高。但是，这种情况应该是例外而不是规则，并且应该仅在确定其安全性和必要性的情况下使用。