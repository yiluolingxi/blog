---
title: webpack - 5 | CJS 与 ESM
date: 2022-08-31
tags:
 - webpack
categories: 
 - webpack
---
## 总结
1.  CJS：Node 中的模块规范，可运行在 Node 环境、webpack 环境，不可运行在浏览器
2.  ESM：一个模块化规范，ECMAScript 语言层规范，可运行在 Node 环境、浏览器。
3.  编译时和运行时：
    1. `require` 运行时代码，可以接收变量实现动态加载。
    2. `import` 编译时代码，编译过程时变量都还没赋值，不可接收变量无法动态加载。`ESM` 为了实现动态加载，便有了 `import()` 函数 API。
    3. `import()` 运行时代码，可以接收变量实现动态加载。
4. `ESM` 是未来的趋势，逐渐从 `CJS` 模块向 `ESM` 转化。



## 提问
- [x] 什么是 ESM/CJS
ESM：一个模块化规范，ECMAScript 语言层规范，可运行在 Node 环境、浏览器。
CJS：Node 中的模块规范，可运行在 Node 环境、webpack 环境，不可运行在浏览器


- [x] 什么是 import(module)
1. `require` 运行时代码，可以接收变量实现动态加载。
2. `import` 编译时代码，编译过程时变量都还没赋值，不可接收变量无法动态加载。`ESM` 为了实现动态加载，便有了 `import()` 函数 API。
3. `import()` 运行时代码，可以接收变量实现动态加载。



## 1. CJS (CommonJS)
`CJS` 是 Node 中的模块规范，通过 `require` 及 `exports` 进行导入导出 (`module.exports` 属于 commonjs2)。      

可以运行在
- Node 环境
- webpack 环境

不可在浏览器中直接使用，一般前端项目是通过 webpack 打包转换 `CJS` 为 ES5（语言层级的规范），才可以在浏览器中使用。       

由于 `CJS` 为动态加载，可直接 `require` 一个变量， `require` 是运行时代码。
```javascript
require(`./${a}`)
```


## 2. ESM (ES Module)
`ESM` 是 tc39 对于 ECMAScript 的模块化规范，正因是语言层规范，因此在 Node 及 浏览器中均会支持。

使用 import/export 进行模块导入导出。
```javascript
// sum.js
export const sum = (x, y) => x + y

// index.js
import { sum } from './sum'
```
两种导出
- 具名导出/导入: `Named` Import/Export
- 默认导出/导入: `Default` Import/Export

`ESM` 为静态导入，正因如此，可在编译期进行 `Tree Shaking`，减少 js 体积。    

如果需要动态导入，tc39 为动态加载模块定义了 API: `import(module)` 。
```javascript
const {default: arrayUniq} = await import('https://cdn.jsdelivr.net/npm/array-uniq/index.js')

arrayUniq([1,1,2,2,2,3]) // [1, 2, 3]
```

`ESM` 是未来的趋势，目前一些 CDN 厂商，前端构建工具均致力于 `CJS` 模块向 `ESM` 的转化，比如 `skypack`、`vite` 等。         
目前，在浏览器与 Node.js 中均原生支持 `ESM`。



## 疑问
- [x] 











个人github：[**https://github.com/zhengjiabo**](https://github.com/zhengjiabo) 