---
title: docker - 12 | CICD
date: 2022-09-19
tags:
 - docker
categories: 
 - docker
---
 



## 总结





## 疑问
- [ ] 







## 提问
- [x] 






  
## 1. 前提提要、场景
前面的部署流程，还停留在手动部署阶段，需要将部署进行自动化：     
**每当我们将前端代码更新并 PUSH 到仓库后，CICD 将会拉取仓库代码并自动部署到服务器**     

![](./220919/1.png)



## 2. CI/CD
- CI：Continuous Integration，持续集成。目的：提高代码的质量，只允许正常的代码被合并到主分支。CI速度快，注重发现错误并反馈给开发人员的速度。是【错误反馈速度】与【执行的检查完整性】之间的权衡。且只有通过自动化测试、Code Review 后才能合并到主分支。
- CD：Continuous Deployment，持续交付、持续部署。(或者 Continuous Delivery，持续交付)。速度相对慢，注重检查完整性。目的：进行彻底检查以发现代码问题。通常以测试的代码覆盖率或功能覆盖率来衡量。持续交付给质量团队或者用户，以供评审。并尽早发现错误可以防止将坏代码部署到任何环境，并节省测试团队验证的宝贵时间。

CI/CD不过是一套机制，并没有固定的落地规范，没必要过于纠结。每个团队面临的开发情况都不一样，选择最合适自己的方案才是最重要的。只需记得 CI/CD 是一个流程，用于实现应用开发中的高度持续自动化和持续监控。              

本地 `eslint` 是基于 `git hooks`，在本地运行。而 `CICD` 相当于服务端的 `git hooks`，与 `git` 集成在一起，在服务端运行。      

- 构建服务器：进行 CI 构建的服务器，一般用以构建、测试和部署，构建镜像以及自动部署服务。也可以是 Docker 容器。
- 部署服务器：对外提供服务的服务器，容器在该服务器中构建并启动。


为了更好的 CICD，构建服务器会赋予控制部署服务集群的权限，在构建服务器中通过一条命令，即可将某个服务在部署服务器集群中进行部署。


在 CICD 中，构建服务器往往会做以下工作
1. 功能分支提交后，通过 CICD 进行自动化测试、语法检查、npm 库风险审计等前端质量保障工程，如未通过 CICD，则无法 Code Review，更无法合并到主分支进行上线
2. 功能分支提交后，通过 CICD 对当前分支代码构建独立镜像，并生成独立的分支环境地址进行测试。如对每一个功能分支生成一个可供测试的地址，一般是 <branch>.dev.demo.com。
3. 功能分支测试通过后，合并到主分支，自动构建镜像并部署到生成环境中 (一般生成环境需要手动触发、自动部署)



## 3. 




## 2. 优化
- 长时间 或 价值不大的测试移至 CD 步骤：确保 CI 运行时间短，最多 3 ~ 7 分钟，开发者也会有意识的等待时间点取得结果，避免开启下一个功能后需要切换上下文，打断开发节奏降低生产力。
- 需要不同级别的自动化测试：为了确保 CI 运行时间短，便不能为每个合并运行所有测试，因为需要花费大量时间。并且大多数测试在该合并请求上毫无意义。例如 非公共层代码变动，无需测试公共层。


## 2. 








## 遗留





个人github：[**https://github.com/zhengjiabo**](https://github.com/zhengjiabo) 