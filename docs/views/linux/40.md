---
title: jq `json` 处理工具
date: 2022-11-28
tags:
 - linux
categories: 
 - linux
---


## 总结
-  





## 提问
- [x] 





## 1. 前提提要、场景
前端经常要和 `JSON` 打交道，各种配置文件也都是 `JSON` 格式。这便需要有个工具，可以操作 `JSON` —— `jq`

学习前请打开 [jq 官方文档](https://stedolan.github.io/jq/manual/)，内有完整示例。会频繁用到。



## 2. 安装
1. 下载 
`curl -O https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64`

2. 更改权限
`chmod a+x jq-linux64`

3. 移动到 `bin` 目录
`mv jq-linux64 /usr/bin/jq`



## 3. 示例准备
`demo.jsonl`: 模拟日志文件中，每行日志记录都是 `json`
> `JSONL` 即 `JSON Lines`
```bash
$ cat <<EOF > demo.jsonl
{"name": "shanyue", "age": 24, "friend": {"name": "shuifeng"}}
{"name": "shuifeng", "age": 25, "friend": {"name": "shanyue"}}
EOF
```

`demo.json`: 模拟后台接口返回的数据
```bash
$ cat <<EOF > demo.json
[
  {"name": "shanyue", "age": 24, "friend": {"name": "shuifeng"}},
  {"name": "shuifeng", "age": 25, "friend": {"name": "shanyue"}}
]
EOF
```


## 4. jq 命令详解
命令：`jq [options...] filter [files]`
- `options`: 选项
- `filter`: 转换操作，类似 `lodash` 函数


### 4.1 option 选项
常用选项: 
- `-s`:  `JSONL` 转 `JSON` (如 `group`, `sort` 只能以数组作为输入)
- `-c`: 不对做 `JSON` 格式化，一行输出。 
- `--stream`: 对 `JSON` 逐字段输出


### 4.2 filter 转换操作
常用选项:
- `get`，`map`，`filter`，`map`，`pick`，`uniq`，`group` 等
- `.`: 代表自身，也可以认为是过滤器。后续加过滤内容。
- `.a.b`: 取属性，相当于 `_.get(input, 'a.b')`
- `select(bool)`: 过滤，相当于 `_.filter(boolFn)`
- `map_values`: 映射，相当于 `_.map`，不过 `jq` 无法单独操作 `key`
- `sort`: 排序 
- `group_by`: 按字段分组 
 


## 5. 场景示例
### 5.1 JSON to JSONL
```bash
# .: 自身-后续加过滤内容。过滤了头 [] 两个字符
$ cat demo.json | jq '.[]'
{
  "name": "shanyue",
  "age": 24,
  "friend": {
    "name": "shuifeng"
  }
}
{
  "name": "shuifeng",
  "age": 25,
  "friend": {
    "name": "shanyue"
  }
}
```

### 5.2 JSONL to JSON











