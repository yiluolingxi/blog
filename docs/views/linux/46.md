---
title: dig 解析域名
date: 2022-12-08
tags:
 - linux
categories: 
 - linux
---


## 总结
- `dig`: 解析域名  
  - `+short`: 仅返回 `IP`
  - `+tract`: 追踪整个过程
  - `-x`: 反向解析，寻找域名。一般可以用来寻找 `DNS` 服务器的域名，判断是否可信





## 提问
- [x]用 `dig` 找到百度所对应的 `IP` 地址 
> `dig www.baidu.com`     





## 1. 前提提要、场景
想要知道一个域名对应的 `IP`，我们经常去具有域名解析功能的网站上解析。`Linux` 可以使用 `dig`（`domain information groper`) 解析域名。


## 2. dig 安装

```bash
# Debian / Ubuntu
$ sudo apt-get install dnsutils

# CentOS / RedHat:
$ sudo yum install bind-utils
```

## 3. dig 

命令：`dig <domain>`     
示例：`dig www.bilibili.com`

### 3.1 dig 直接解析域名
```bash
# 查找哔哩哔哩的 IP 地址，哔哩哔哩做了负载均衡 查到多个 IP 证明负载均衡
# 可以看到 CNAME 到某个 CDN 全局负载服务器上。判断出网站部署在 CDN。
$ dig www.bilibili.com 

; <<>> DiG 9.11.5-P4-5.1+deb10u7-Debian <<>> www.bilibili.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 38571
;; flags: qr rd ra; QUERY: 1, ANSWER: 22, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;www.bilibili.com.              IN      A

;; ANSWER SECTION:
www.bilibili.com.       57      IN      CNAME   a.w.bilicdn1.com.
a.w.bilicdn1.com.       41      IN      CNAME   ct.w.bilicdn1.com.
ct.w.bilicdn1.com.      25      IN      A       124.239.244.16
ct.w.bilicdn1.com.      25      IN      A       61.147.236.43
ct.w.bilicdn1.com.      25      IN      A       61.147.236.44
ct.w.bilicdn1.com.      25      IN      A       183.131.147.27
ct.w.bilicdn1.com.      25      IN      A       124.239.244.15
ct.w.bilicdn1.com.      25      IN      A       61.147.236.46
ct.w.bilicdn1.com.      25      IN      A       183.131.147.30
ct.w.bilicdn1.com.      25      IN      A       116.207.137.66
ct.w.bilicdn1.com.      25      IN      A       183.131.147.28
ct.w.bilicdn1.com.      25      IN      A       171.214.10.141
ct.w.bilicdn1.com.      25      IN      A       171.214.10.142
ct.w.bilicdn1.com.      25      IN      A       183.131.147.29
ct.w.bilicdn1.com.      25      IN      A       61.147.236.42
ct.w.bilicdn1.com.      25      IN      A       116.207.137.67
ct.w.bilicdn1.com.      25      IN      A       124.239.244.18
ct.w.bilicdn1.com.      25      IN      A       116.207.137.68
ct.w.bilicdn1.com.      25      IN      A       124.239.244.17
ct.w.bilicdn1.com.      25      IN      A       61.147.236.45
ct.w.bilicdn1.com.      25      IN      A       183.131.147.48
ct.w.bilicdn1.com.      25      IN      A       171.214.10.140

;; Query time: 1 msec
;; SERVER: 100.125.135.29#53(100.125.135.29)
;; WHEN: Thu Dec 08 17:40:56 CST 2022
;; MSG SIZE  rcvd: 409
```

> 看到 `;; ANSWER SECTION:` 第二列那串数字了吧，`TTL`(`TIME TO LIVE`) 存活时间，经过一个中间设备（路由器）便会减 1，直至 0 便会丢弃该数据包并返回 `ICMP`(`IP` 的辅助协议) 互联网控制报文协议给发送点，告知差错信息（内含有报错地址和原因）。之所以有 `TTL` 是为了防止错误的路由表导致回环。           
> 所以相同初始值下，`TTL` 数值越大证明离得越近。初始值惯例为：      
> - 0: 相同主机
> - 1: 同一子网
> - 32: 同一站点（市）
> - 64: 同一区域（省，国）
> - 128: 同一大陆板块
> - 255: 没有限制
> 所以能看到 `CDN` 服务器 `a.w.bilicdn1.com.` 的 `TTL` `57` 是最高的，本次只使用  `64 - 57 = 7` 个中间设备，下一次就不知道了。


### 3.2 `dig +short` 仅返回 IP
过滤其他信息，仅仅返回 `IP`
```bash
$ dig +short www.bilibili.com
a.w.bilicdn1.com.
ct.w.bilicdn1.com.
117.21.179.18
183.131.147.28
117.21.179.19
116.207.137.66
183.131.147.48
61.147.236.42
116.207.137.67
61.147.236.44
117.23.60.12
61.147.236.46
116.207.137.68
117.21.179.20
171.214.10.142
183.131.147.29
183.131.147.30
183.131.147.27
61.147.236.45
171.214.10.141
61.147.236.43
117.23.60.13
```


### 3.3 `dig -x` 反向解析

```bash
# 例如查找 dns 服务器的域名，发现是谷歌系的，安心使用该 dns 服务器
$ dig -x 8.8.8.8 +short 
dns.google.
```



### 3.4 `dig +trace` 追踪整个过程


```bash
$ dig +trace a.w.bilicdn1.com. 
; <<>> DiG 9.11.5-P4-5.1+deb10u7-Debian <<>> +trace a.w.bilicdn1.com.
;; global options: +cmd
.                       21552   IN      NS      f.root-servers.net.
.                       21552   IN      NS      i.root-servers.net.
.                       21552   IN      NS      m.root-servers.net.
.                       21552   IN      NS      l.root-servers.net.
.                       21552   IN      NS      h.root-servers.net.
.                       21552   IN      NS      e.root-servers.net.
.                       21552   IN      NS      c.root-servers.net.
.                       21552   IN      NS      j.root-servers.net.
.                       21552   IN      NS      k.root-servers.net.
.                       21552   IN      NS      g.root-servers.net.
.                       21552   IN      NS      b.root-servers.net.
.                       21552   IN      NS      a.root-servers.net.
.                       21552   IN      NS      d.root-servers.net.
;; Received 239 bytes from 100.125.135.29#53(100.125.135.29) in 1 ms

com.                    172800  IN      NS      e.gtld-servers.net.
com.                    172800  IN      NS      g.gtld-servers.net.
com.                    172800  IN      NS      a.gtld-servers.net.
com.                    172800  IN      NS      c.gtld-servers.net.
com.                    172800  IN      NS      i.gtld-servers.net.
com.                    172800  IN      NS      m.gtld-servers.net.
com.                    172800  IN      NS      k.gtld-servers.net.
com.                    172800  IN      NS      d.gtld-servers.net.
com.                    172800  IN      NS      f.gtld-servers.net.
com.                    172800  IN      NS      h.gtld-servers.net.
com.                    172800  IN      NS      j.gtld-servers.net.
com.                    172800  IN      NS      l.gtld-servers.net.
com.                    172800  IN      NS      b.gtld-servers.net.
com.                    86400   IN      DS      30909 8 2 E2D3C916F6DEEAC73294E8268FB5885044A833FC5459588F4A9184CF C41A5766
com.                    86400   IN      RRSIG   DS 8 1 86400 20221221050000 20221208040000 18733 . kncnR3wTm4XC/2IjTtAsSiSbKDotqQsx9zDysfBszbyocbaIywz8Vihs aCgvuzmFgQS6zTi0QghgkbzG/OiDeKM1wKY/zy2j4u/noSHusIxfRqox ho0tv/qUR82LVIOEmQJcP6bf+xd/hVtibzcmmqDtYgmAiu7FZ1Zl12mo C+pMD5blHjhLAh6GyERZwOtUb/POVfuIbXy+OpF6YYqdrs0j0V4ggawb QkpaWW8H6I2wt9uNetaDV++DpO69taYpvOzdVJSw0ah/3yhbd6+IFmMY gLmUZrWy7k3D4rUL7Gy63m8ADYkcMObnMs4LH1VGGnpx7WaISamyMChO y+87kQ==
;; Received 1204 bytes from 192.33.4.12#53(c.root-servers.net) in 12 ms

bilicdn1.com.           172800  IN      NS      ns3.dnsv5.com.
bilicdn1.com.           172800  IN      NS      ns4.dnsv5.com.
CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN NSEC3 1 1 0 - CK0Q2D6NI4I7EQH8NA30NS61O48UL8G5 NS SOA RRSIG DNSKEY NSEC3PARAM
CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN RRSIG NSEC3 8 2 86400 20221213052435 20221206041435 53929 com. Kf5Q1vq6SCsqlKJThCyWesc8D9x/agamQYybsKkqA4WYmm8bySHKgAyE yzD2rLqTn31lwpdccGYurVRIRt5KS6xPZFBe4oNvix8mP/jH0RsXWUMN v7i9u00ycNGEZk0w/d7flhXbrNGJM4BTiZtJDnCC1eMqwBDaonSH/xks mPIN9pUSl0cwlfr16As8+ugYTZUh4mbzTQrsMftnpqIVtw==
78IDJJ8BD8J8D7PIS2HPCDAJDGQHDAKN.com. 86400 IN NSEC3 1 1 0 - 78IDSM7E0N1FILAHG6MUNE0L5I9IIM0K NS DS RRSIG
78IDJJ8BD8J8D7PIS2HPCDAJDGQHDAKN.com. 86400 IN RRSIG NSEC3 8 2 86400 20221214071508 20221207060508 53929 com. G67yfKhsD4/T0zLExpgx7s7AqHQyCuD/Tv/8ZD71Z6D2F5sOC4CV5ff4 UKRlCOHDoh2HwXIxSw40zo3oShvj4RgmlYyt9wRRxZnXBO8xwSU5MOAK tgApCzGeELz2bLgrZxYQq0y9iv78V8jl0dbrMbISsS+gaFLP09GPdYyi TH6SMxO7HWFCYeu4KPxH+6VyXHVmtTSBhmnB3BbpjOuARw==
;; Received 964 bytes from 192.54.112.30#53(h.gtld-servers.net) in 205 ms

a.w.bilicdn1.com.       300     IN      CNAME   ct.w.bilicdn1.com.
ct.w.bilicdn1.com.      90      IN      A       61.147.236.42
ct.w.bilicdn1.com.      90      IN      A       61.147.236.43
ct.w.bilicdn1.com.      90      IN      A       61.147.236.44
ct.w.bilicdn1.com.      90      IN      A       61.147.236.45
ct.w.bilicdn1.com.      90      IN      A       61.147.236.46
ct.w.bilicdn1.com.      90      IN      A       116.207.137.66
ct.w.bilicdn1.com.      90      IN      A       116.207.137.67
ct.w.bilicdn1.com.      90      IN      A       116.207.137.68
ct.w.bilicdn1.com.      90      IN      A       117.21.179.18
ct.w.bilicdn1.com.      90      IN      A       117.21.179.19
ct.w.bilicdn1.com.      90      IN      A       117.21.179.20
ct.w.bilicdn1.com.      90      IN      A       117.23.60.12
ct.w.bilicdn1.com.      90      IN      A       117.23.60.13
ct.w.bilicdn1.com.      90      IN      A       117.23.60.14
ct.w.bilicdn1.com.      90      IN      A       117.23.60.15
ct.w.bilicdn1.com.      90      IN      A       118.116.2.140
ct.w.bilicdn1.com.      90      IN      A       118.116.2.141
ct.w.bilicdn1.com.      90      IN      A       118.116.2.142
ct.w.bilicdn1.com.      90      IN      A       124.239.244.15
ct.w.bilicdn1.com.      90      IN      A       124.239.244.16
bilicdn1.com.           86400   IN      NS      ns3.dnsv5.com.
bilicdn1.com.           86400   IN      NS      ns4.dnsv5.com.
;; Received 450 bytes from 1.12.0.18#53(ns3.dnsv5.com) in 5 ms

```


